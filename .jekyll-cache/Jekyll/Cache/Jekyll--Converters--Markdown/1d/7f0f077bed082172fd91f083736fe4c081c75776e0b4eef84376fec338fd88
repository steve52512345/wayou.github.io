I"m<h1 id="emscripten-安装">Emscripten 安装</h1>

<h2 id="通过-homebrew-安装">通过 Homebrew 安装</h2>

<p>可以通过官方的 <a href="https://emscripten.org/docs/getting_started/downloads.html">Download and install</a> 页面描述的步骤来进行，但也有更加便捷的方式，比如通过 Homebrew，只需执行如下命令即可：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>brew <span class="nb">install </span>emscripten
</code></pre></div></div>

<h2 id="emscripten-文件的配置"><code class="language-plaintext highlighter-rouge">.emscripten</code> 文件的配置</h2>

<p>完成成功后， 会有个配置的提示：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>==&gt; Caveats
Manually set LLVM_ROOT to
  /usr/local/opt/emscripten/libexec/llvm/bin
and comment out BINARYEN_ROOT
in ~/.emscripten after running `emcc` for the first time.
</code></pre></div></div>

<p>即首次运行 <code class="language-plaintext highlighter-rouge">emcc</code> 后，会生成一个 <code class="language-plaintext highlighter-rouge">~/.emscripten</code> 配置文件，将其中的 <code class="language-plaintext highlighter-rouge">LLVM_ROOT</code> 设置成上面提示的路径，同时注释掉 <code class="language-plaintext highlighter-rouge">BINARYEN_ROOT</code>。</p>

<h3 id="运行-emcc-检查安装">运行 <code class="language-plaintext highlighter-rouge">emcc</code> 检查安装</h3>

<p>运行 <code class="language-plaintext highlighter-rouge">emcc</code> 检查是否安装成功：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>emcc <span class="nt">-v</span>
<span class="o">==============================================================================</span>
Welcome to Emscripten!

This is the first <span class="nb">time </span>any of the Emscripten tools has been run.

A settings file has been copied to ~/.emscripten, at absolute path: /Users/wayou/.emscripten

It contains our best guesses <span class="k">for </span>the important paths, which are:

  LLVM_ROOT       <span class="o">=</span> /usr/bin
  NODE_JS         <span class="o">=</span> /Users/wayou/.nvm/versions/node/v12.1.0/bin/node
  EMSCRIPTEN_ROOT <span class="o">=</span> /usr/local/Cellar/emscripten/1.39.8/libexec

Please edit the file <span class="k">if </span>any of those are incorrect.

This <span class="nb">command </span>will now exit. When you are <span class="k">done </span>editing those paths, re-run it.
<span class="o">==============================================================================</span>
</code></pre></div></div>

<p>然后按照上面提示配置 <code class="language-plaintext highlighter-rouge">~/.emscripten</code>，再次运行 <code class="language-plaintext highlighter-rouge">emcc</code> 时，如果是 1.38.44 之后的版本，会发现报错：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>emcc <span class="nt">-v</span>
shared:ERROR: BINARYEN_ROOT is not defined <span class="k">in</span> /Users/wayou/.emscripten
</code></pre></div></div>

<h3 id="binaryen_root-的设置"><code class="language-plaintext highlighter-rouge">BINARYEN_ROOT</code> 的设置</h3>

<p>因为前面步骤注释掉了 <code class="language-plaintext highlighter-rouge">BINARYEN_ROOT</code>，所以这里提示该字段没有设置。查询后发现这里有对这个问题的讨论，具体原因来自 1.38.44 中的改动：</p>

<blockquote>
  <h2 id="v13844-09112019">v1.38.44: 09/11/2019</h2>
  <ul>
    <li>Remove Binaryen from the ports system. This means that emscripten will
no longer automatically build Binaryen from source. Instead, either use
the emsdk (binaries are provided automatically, just like for LLVM), or
build it yourself and point <code class="language-plaintext highlighter-rouge">BINARYEN_ROOT</code> in .emscripten to it. See #9409
-- <em>引用自 emscripten 的发版日志</em></li>
  </ul>
</blockquote>

<p>解决办法是安装 <code class="language-plaintext highlighter-rouge">binaryen</code> 并且设置 <code class="language-plaintext highlighter-rouge">BINARYEN_ROOT</code> 到 <code class="language-plaintext highlighter-rouge">/usr/local/opt/binaryen</code> 这个路径。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>brew <span class="nb">install </span>binaryen
</code></pre></div></div>

<p>编辑 <code class="language-plaintext highlighter-rouge">~/.emscripten</code> 设置 <code class="language-plaintext highlighter-rouge">BINARYEN_ROOT</code>：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BINARYEN_ROOT = '/usr/local/opt/binaryen'
</code></pre></div></div>

<p>再次运行 <code class="language-plaintext highlighter-rouge">emcc</code> 检查是否一切正常：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>emcc <span class="nt">-v</span>
cache:INFO: generating system asset: is_vanilla.txt... <span class="o">(</span>this will be cached <span class="k">in</span> <span class="s2">"/Users/wayou/.emscripten_cache/is_vanilla.txt"</span> <span class="k">for </span>subsequent builds<span class="o">)</span>
cache:INFO:  - ok
emcc <span class="o">(</span>Emscripten gcc/clang-like replacement + linker emulating GNU ld<span class="o">)</span> 1.39.8
clang version 6.0.1  <span class="o">(</span>emscripten 1.39.8 : 1.39.8<span class="o">)</span>
Target: x86_64-apple-darwin19.3.0
Thread model: posix
InstalledDir: /usr/local/opt/emscripten/libexec/llvm/bin
shared:INFO: <span class="o">(</span>Emscripten: Running sanity checks<span class="o">)</span>
</code></pre></div></div>

<p>至此，通过 Homebrew 方式成功安装 emscripten。</p>

<h2 id="相关资源">相关资源</h2>

<ul>
  <li><a href="https://emscripten.org/docs/getting_started/downloads.html">Emscripten documentation - Download and install</a></li>
  <li><a href="https://github.com/Homebrew/homebrew-core/issues/47869#issue-537885207">Emscripten needs Binaryen while compiling to wasm #47869</a></li>
  <li><a href="https://formulae.brew.sh/formula/emscripten">Homebrew Formulae - emscripten</a></li>
</ul>

:ET
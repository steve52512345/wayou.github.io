<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>创建 fish shell 自动补全文件 | 牛さんの部落格</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="创建 fish shell 自动补全文件" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="创建 fish shell 自动补全文件 关于自动补全的文档参见 Tab Completion。 completions 文件的位置 根据文档，fish 自带的 completions 文件在 /usr/share/fish/completions。当然，根据安装来源及本机实际安装的插件，和其他环境的不同，fish 的默认 completions 文件和实际加载的来源会有差异，可以通过如下命令查看： $ echo $fish_complete_path /Users/wayou/.config/fish/completions /Users/wayou/.local/share/omf/pkg/notify/completions /Users/wayou/.local/share/omf/pkg/notify/completions /Users/wayou/.local/share/omf/pkg/nvm/completions /Users/wayou/.local/share/omf/pkg/omf/completions /usr/local/Cellar/fish/3.1.0/etc/fish/completions /usr/local/Cellar/fish/3.1.0/share/fish/vendor_completions.d /usr/local/share/fish/vendor_completions.d /usr/local/Cellar/fish/3.1.0/share/fish/completions /Users/wayou/.local/share/fish/generated_completions 可以看出，本机因为安装的 omf，所以路径中包含了 omf 相关的路径。其中，因为 fish 是通过 brew 进行安装，其默认的 completions 文件在 /usr/local/Cellar/fish/3.1.0/share/fish/completions，可以查看该目录的文件进行学习，和自己编写 completion 文件的参数。 自己写的补全文件放置到 ~/.config/fish/completions 目录下即可。如果没有该目录，创建一个。 语法 自动实例是通过 complete 命令完成的，一般后面紧跟需要补全的命令名，比如 myprog，它可以跟一个 yes 或 no 作为其参数，补全脚本可以这样来写： complete -c myprog -a &quot;yes no&quot; 其中， -c 即 --command 指定需要补全的命令名 -a 即 --arguments 指定命令后面自动列表出补全列表，形式为一个字符串，里面可通过空格，tab，variable expansion，Command Substitutions 或其他形式的变量展开符进行分隔，这里简单知道可以用空格分隔补全列表即可。 更加详尽的参数参见：complete - edit command specific tab-completions。 编写补全脚本 因为测试需要实际有相应可执行程序才行，下面以 node 为例，为其添加自动补全。 创建补全文件到 ~/.config/fish/completions 目录下： $ touch ~/.config/fish/completions/test.fish 输入以下内容： complete -c node -a &quot;yes no&quot; 加载补全脚本 讲道理，放到对应目录后，fish 会自动加载，但是在下次打开命令行的时候。如果要立即生效，需要重新 source 一下该文件： $ source ~/.config/fish/completions/test.fish 测试自动补全： $ node no yes 关闭文件提示 fish 默认会把当前目录下的文件作为补全候选对象，如果命令后不需要跟文件，可关通过 -f 即 --no-files 关闭文件的提示： complete -f -c node -a &quot;yes no&quot; 发布到 omf 插件 发布到 omf 插件，这样别人可以通过 omf install 方便地安装。 deno 的自动补全文件 以 deno 的自动补全为例。本周 Deno 1.0 正式版释出，伴随着自带了一个命令可输出对应 shell 下的自动补全脚本，比如 fish 的可通过如下命令获取到： $ deno completions fish `deno completions fish` 的输出 ```sh $ deno completions fish complete -c deno -n &quot;__fish_use_subcommand&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_use_subcommand&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;bundle&quot; -d &#39;Bundle module and dependencies into single file&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;completions&quot; -d &#39;Generate shell completions&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;eval&quot; -d &#39;Eval script&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;cache&quot; -d &#39;Cache the dependencies&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;fmt&quot; -d &#39;Format source files&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;info&quot; -d &#39;Show info about cache or info related to source file&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;install&quot; -d &#39;Install script as an executable&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;repl&quot; -d &#39;Read Eval Print Loop&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;run&quot; -d &#39;Run a program given a filename or url to the module&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;test&quot; -d &#39;Run tests&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;types&quot; -d &#39;Print runtime TypeScript declarations&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;upgrade&quot; -d &#39;Upgrade deno executable to given version&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;doc&quot; -d &#39;Show documentation for a module&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;help&quot; -d &#39;Prints this message or the help of the given subcommand(s)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s T -l ts -d &#39;Treat eval input as TypeScript&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l lock -d &#39;Check the specified lock file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l lock-write -d &#39;Write lock file. Use with --lock.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l no-remote -d &#39;Do not resolve remote modules&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -l check -d &#39;Check if the source files are formatted.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-read -d &#39;Allow file system read access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-write -d &#39;Allow file system write access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-net -d &#39;Allow network access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s n -l name -d &#39;Executable file name&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l root -d &#39;Installation root&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-env -d &#39;Allow environment access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-run -d &#39;Allow running subprocesses&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-plugin -d &#39;Allow loading plugins&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-hrtime -d &#39;Allow high resolution time measurement&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s A -l allow-all -d &#39;Allow all permissions&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s f -l force -d &#39;Forcefully overwrite existing installation&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-read -d &#39;Allow file system read access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-write -d &#39;Allow file system write access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-net -d &#39;Allow network access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l lock -d &#39;Check the specified lock file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l seed -d &#39;Seed Math.random()&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-env -d &#39;Allow environment access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-run -d &#39;Allow running subprocesses&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-plugin -d &#39;Allow loading plugins&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-hrtime -d &#39;Allow high resolution time measurement&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s A -l allow-all -d &#39;Allow all permissions&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l lock-write -d &#39;Write lock file. Use with --lock.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l no-remote -d &#39;Do not resolve remote modules&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l cached-only -d &#39;Require that remote dependencies are already cached&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-read -d &#39;Allow file system read access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-write -d &#39;Allow file system write access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-net -d &#39;Allow network access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l lock -d &#39;Check the specified lock file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l seed -d &#39;Seed Math.random()&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l filter -d &#39;A pattern to filter the tests to run by&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-env -d &#39;Allow environment access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-run -d &#39;Allow running subprocesses&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-plugin -d &#39;Allow loading plugins&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-hrtime -d &#39;Allow high resolution time measurement&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s A -l allow-all -d &#39;Allow all permissions&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l lock-write -d &#39;Write lock file. Use with --lock.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l no-remote -d &#39;Do not resolve remote modules&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l cached-only -d &#39;Require that remote dependencies are already cached&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l failfast -d &#39;Stop on first error&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-none -d &#39;Don\&#39;t return error code if no test files are found&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -l version -d &#39;The version to upgrade to&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -l dry-run -d &#39;Perform all checks without replacing old exe&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s f -l force -d &#39;Replace current exe even if not out-of-date&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -l json -d &#39;Output documentation in JSON format.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; ``` 可以将其输出到文件并保存在 ~/.config/fish/completions 目录下，fish 里就可以生效使用了。 $ deno completions fish &gt; ~/.config/fish/completions/deno.fish 但是这样只能自己本地使用，如果换台机器需要重新进行上面的步骤，别人也没法共享。通过编写成 omf 插件发布后，就可通过 omf 进行安装使用了。 编写 omf 插件 根据 omf 的文档进行插件的编写。 通过 omf new plugin &lt;plugin-name&gt; 可快速初始化一个插件： $ omf new plugin plugin-deno 命令执行后生成了如下文件： . ├── LICENSE ├── README.md ├── completions │   └── plugin-deno.fish ├── functions │   └── plugin-deno.fish ├── init.fish └── uninstall.fish 其中，functions，init.fish 和 uninstall.fish 用不到，直接删除。 然后将 completions/plugin-deno.fish重命名成 completions/deno.fish，将 deno completions fish 的输出写入。 $ deno completions fish &gt; completions/deno.fish 完善 README.md 后就可以 push 到 GitHub 了。 测试安装 代码推送到远端后，可通过如下命令进行安装： $ omf install https://github.com/wayou/plugin-deno 添加到 omf 插件仓库 完成测试没问题后，最后一步，clone oh-my-fish/packages-main 添加名为 deno 的文件到 packages 目录下，完善其内容： type = plugin repository = YOUR-PACKAGE-URL maintainer = YOUR-NAME &lt;YOUR-EMAIL&gt; description = YOUR-PACKAGE-DESCRIPTION 便可以提 PR 到该仓库了。合并后即可通过 omf install deno 进行安装使用了。 相关资源 Writing your own completions¶" />
<meta property="og:description" content="创建 fish shell 自动补全文件 关于自动补全的文档参见 Tab Completion。 completions 文件的位置 根据文档，fish 自带的 completions 文件在 /usr/share/fish/completions。当然，根据安装来源及本机实际安装的插件，和其他环境的不同，fish 的默认 completions 文件和实际加载的来源会有差异，可以通过如下命令查看： $ echo $fish_complete_path /Users/wayou/.config/fish/completions /Users/wayou/.local/share/omf/pkg/notify/completions /Users/wayou/.local/share/omf/pkg/notify/completions /Users/wayou/.local/share/omf/pkg/nvm/completions /Users/wayou/.local/share/omf/pkg/omf/completions /usr/local/Cellar/fish/3.1.0/etc/fish/completions /usr/local/Cellar/fish/3.1.0/share/fish/vendor_completions.d /usr/local/share/fish/vendor_completions.d /usr/local/Cellar/fish/3.1.0/share/fish/completions /Users/wayou/.local/share/fish/generated_completions 可以看出，本机因为安装的 omf，所以路径中包含了 omf 相关的路径。其中，因为 fish 是通过 brew 进行安装，其默认的 completions 文件在 /usr/local/Cellar/fish/3.1.0/share/fish/completions，可以查看该目录的文件进行学习，和自己编写 completion 文件的参数。 自己写的补全文件放置到 ~/.config/fish/completions 目录下即可。如果没有该目录，创建一个。 语法 自动实例是通过 complete 命令完成的，一般后面紧跟需要补全的命令名，比如 myprog，它可以跟一个 yes 或 no 作为其参数，补全脚本可以这样来写： complete -c myprog -a &quot;yes no&quot; 其中， -c 即 --command 指定需要补全的命令名 -a 即 --arguments 指定命令后面自动列表出补全列表，形式为一个字符串，里面可通过空格，tab，variable expansion，Command Substitutions 或其他形式的变量展开符进行分隔，这里简单知道可以用空格分隔补全列表即可。 更加详尽的参数参见：complete - edit command specific tab-completions。 编写补全脚本 因为测试需要实际有相应可执行程序才行，下面以 node 为例，为其添加自动补全。 创建补全文件到 ~/.config/fish/completions 目录下： $ touch ~/.config/fish/completions/test.fish 输入以下内容： complete -c node -a &quot;yes no&quot; 加载补全脚本 讲道理，放到对应目录后，fish 会自动加载，但是在下次打开命令行的时候。如果要立即生效，需要重新 source 一下该文件： $ source ~/.config/fish/completions/test.fish 测试自动补全： $ node no yes 关闭文件提示 fish 默认会把当前目录下的文件作为补全候选对象，如果命令后不需要跟文件，可关通过 -f 即 --no-files 关闭文件的提示： complete -f -c node -a &quot;yes no&quot; 发布到 omf 插件 发布到 omf 插件，这样别人可以通过 omf install 方便地安装。 deno 的自动补全文件 以 deno 的自动补全为例。本周 Deno 1.0 正式版释出，伴随着自带了一个命令可输出对应 shell 下的自动补全脚本，比如 fish 的可通过如下命令获取到： $ deno completions fish `deno completions fish` 的输出 ```sh $ deno completions fish complete -c deno -n &quot;__fish_use_subcommand&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_use_subcommand&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;bundle&quot; -d &#39;Bundle module and dependencies into single file&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;completions&quot; -d &#39;Generate shell completions&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;eval&quot; -d &#39;Eval script&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;cache&quot; -d &#39;Cache the dependencies&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;fmt&quot; -d &#39;Format source files&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;info&quot; -d &#39;Show info about cache or info related to source file&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;install&quot; -d &#39;Install script as an executable&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;repl&quot; -d &#39;Read Eval Print Loop&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;run&quot; -d &#39;Run a program given a filename or url to the module&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;test&quot; -d &#39;Run tests&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;types&quot; -d &#39;Print runtime TypeScript declarations&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;upgrade&quot; -d &#39;Upgrade deno executable to given version&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;doc&quot; -d &#39;Show documentation for a module&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;help&quot; -d &#39;Prints this message or the help of the given subcommand(s)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s T -l ts -d &#39;Treat eval input as TypeScript&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l lock -d &#39;Check the specified lock file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l lock-write -d &#39;Write lock file. Use with --lock.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l no-remote -d &#39;Do not resolve remote modules&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -l check -d &#39;Check if the source files are formatted.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-read -d &#39;Allow file system read access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-write -d &#39;Allow file system write access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-net -d &#39;Allow network access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s n -l name -d &#39;Executable file name&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l root -d &#39;Installation root&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-env -d &#39;Allow environment access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-run -d &#39;Allow running subprocesses&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-plugin -d &#39;Allow loading plugins&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-hrtime -d &#39;Allow high resolution time measurement&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s A -l allow-all -d &#39;Allow all permissions&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s f -l force -d &#39;Forcefully overwrite existing installation&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-read -d &#39;Allow file system read access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-write -d &#39;Allow file system write access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-net -d &#39;Allow network access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l lock -d &#39;Check the specified lock file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l seed -d &#39;Seed Math.random()&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-env -d &#39;Allow environment access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-run -d &#39;Allow running subprocesses&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-plugin -d &#39;Allow loading plugins&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-hrtime -d &#39;Allow high resolution time measurement&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s A -l allow-all -d &#39;Allow all permissions&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l lock-write -d &#39;Write lock file. Use with --lock.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l no-remote -d &#39;Do not resolve remote modules&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l cached-only -d &#39;Require that remote dependencies are already cached&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-read -d &#39;Allow file system read access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-write -d &#39;Allow file system write access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-net -d &#39;Allow network access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l lock -d &#39;Check the specified lock file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l seed -d &#39;Seed Math.random()&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l filter -d &#39;A pattern to filter the tests to run by&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-env -d &#39;Allow environment access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-run -d &#39;Allow running subprocesses&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-plugin -d &#39;Allow loading plugins&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-hrtime -d &#39;Allow high resolution time measurement&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s A -l allow-all -d &#39;Allow all permissions&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l lock-write -d &#39;Write lock file. Use with --lock.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l no-remote -d &#39;Do not resolve remote modules&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l cached-only -d &#39;Require that remote dependencies are already cached&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l failfast -d &#39;Stop on first error&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-none -d &#39;Don\&#39;t return error code if no test files are found&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -l version -d &#39;The version to upgrade to&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -l dry-run -d &#39;Perform all checks without replacing old exe&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s f -l force -d &#39;Replace current exe even if not out-of-date&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -l json -d &#39;Output documentation in JSON format.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; ``` 可以将其输出到文件并保存在 ~/.config/fish/completions 目录下，fish 里就可以生效使用了。 $ deno completions fish &gt; ~/.config/fish/completions/deno.fish 但是这样只能自己本地使用，如果换台机器需要重新进行上面的步骤，别人也没法共享。通过编写成 omf 插件发布后，就可通过 omf 进行安装使用了。 编写 omf 插件 根据 omf 的文档进行插件的编写。 通过 omf new plugin &lt;plugin-name&gt; 可快速初始化一个插件： $ omf new plugin plugin-deno 命令执行后生成了如下文件： . ├── LICENSE ├── README.md ├── completions │   └── plugin-deno.fish ├── functions │   └── plugin-deno.fish ├── init.fish └── uninstall.fish 其中，functions，init.fish 和 uninstall.fish 用不到，直接删除。 然后将 completions/plugin-deno.fish重命名成 completions/deno.fish，将 deno completions fish 的输出写入。 $ deno completions fish &gt; completions/deno.fish 完善 README.md 后就可以 push 到 GitHub 了。 测试安装 代码推送到远端后，可通过如下命令进行安装： $ omf install https://github.com/wayou/plugin-deno 添加到 omf 插件仓库 完成测试没问题后，最后一步，clone oh-my-fish/packages-main 添加名为 deno 的文件到 packages 目录下，完善其内容： type = plugin repository = YOUR-PACKAGE-URL maintainer = YOUR-NAME &lt;YOUR-EMAIL&gt; description = YOUR-PACKAGE-DESCRIPTION 便可以提 PR 到该仓库了。合并后即可通过 omf install deno 进行安装使用了。 相关资源 Writing your own completions¶" />
<link rel="canonical" href="http://localhost:4000/2020/05/17/%E5%88%9B%E5%BB%BA-fish-shell-%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%E6%96%87%E4%BB%B6.html" />
<meta property="og:url" content="http://localhost:4000/2020/05/17/%E5%88%9B%E5%BB%BA-fish-shell-%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%E6%96%87%E4%BB%B6.html" />
<meta property="og:site_name" content="牛さんの部落格" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-17T23:05:00+08:00" />
<script type="application/ld+json">
{"url":"http://localhost:4000/2020/05/17/%E5%88%9B%E5%BB%BA-fish-shell-%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%E6%96%87%E4%BB%B6.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/05/17/%E5%88%9B%E5%BB%BA-fish-shell-%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%E6%96%87%E4%BB%B6.html"},"description":"创建 fish shell 自动补全文件 关于自动补全的文档参见 Tab Completion。 completions 文件的位置 根据文档，fish 自带的 completions 文件在 /usr/share/fish/completions。当然，根据安装来源及本机实际安装的插件，和其他环境的不同，fish 的默认 completions 文件和实际加载的来源会有差异，可以通过如下命令查看： $ echo $fish_complete_path /Users/wayou/.config/fish/completions /Users/wayou/.local/share/omf/pkg/notify/completions /Users/wayou/.local/share/omf/pkg/notify/completions /Users/wayou/.local/share/omf/pkg/nvm/completions /Users/wayou/.local/share/omf/pkg/omf/completions /usr/local/Cellar/fish/3.1.0/etc/fish/completions /usr/local/Cellar/fish/3.1.0/share/fish/vendor_completions.d /usr/local/share/fish/vendor_completions.d /usr/local/Cellar/fish/3.1.0/share/fish/completions /Users/wayou/.local/share/fish/generated_completions 可以看出，本机因为安装的 omf，所以路径中包含了 omf 相关的路径。其中，因为 fish 是通过 brew 进行安装，其默认的 completions 文件在 /usr/local/Cellar/fish/3.1.0/share/fish/completions，可以查看该目录的文件进行学习，和自己编写 completion 文件的参数。 自己写的补全文件放置到 ~/.config/fish/completions 目录下即可。如果没有该目录，创建一个。 语法 自动实例是通过 complete 命令完成的，一般后面紧跟需要补全的命令名，比如 myprog，它可以跟一个 yes 或 no 作为其参数，补全脚本可以这样来写： complete -c myprog -a &quot;yes no&quot; 其中， -c 即 --command 指定需要补全的命令名 -a 即 --arguments 指定命令后面自动列表出补全列表，形式为一个字符串，里面可通过空格，tab，variable expansion，Command Substitutions 或其他形式的变量展开符进行分隔，这里简单知道可以用空格分隔补全列表即可。 更加详尽的参数参见：complete - edit command specific tab-completions。 编写补全脚本 因为测试需要实际有相应可执行程序才行，下面以 node 为例，为其添加自动补全。 创建补全文件到 ~/.config/fish/completions 目录下： $ touch ~/.config/fish/completions/test.fish 输入以下内容： complete -c node -a &quot;yes no&quot; 加载补全脚本 讲道理，放到对应目录后，fish 会自动加载，但是在下次打开命令行的时候。如果要立即生效，需要重新 source 一下该文件： $ source ~/.config/fish/completions/test.fish 测试自动补全： $ node no yes 关闭文件提示 fish 默认会把当前目录下的文件作为补全候选对象，如果命令后不需要跟文件，可关通过 -f 即 --no-files 关闭文件的提示： complete -f -c node -a &quot;yes no&quot; 发布到 omf 插件 发布到 omf 插件，这样别人可以通过 omf install 方便地安装。 deno 的自动补全文件 以 deno 的自动补全为例。本周 Deno 1.0 正式版释出，伴随着自带了一个命令可输出对应 shell 下的自动补全脚本，比如 fish 的可通过如下命令获取到： $ deno completions fish `deno completions fish` 的输出 ```sh $ deno completions fish complete -c deno -n &quot;__fish_use_subcommand&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_use_subcommand&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;bundle&quot; -d &#39;Bundle module and dependencies into single file&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;completions&quot; -d &#39;Generate shell completions&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;eval&quot; -d &#39;Eval script&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;cache&quot; -d &#39;Cache the dependencies&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;fmt&quot; -d &#39;Format source files&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;info&quot; -d &#39;Show info about cache or info related to source file&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;install&quot; -d &#39;Install script as an executable&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;repl&quot; -d &#39;Read Eval Print Loop&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;run&quot; -d &#39;Run a program given a filename or url to the module&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;test&quot; -d &#39;Run tests&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;types&quot; -d &#39;Print runtime TypeScript declarations&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;upgrade&quot; -d &#39;Upgrade deno executable to given version&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;doc&quot; -d &#39;Show documentation for a module&#39; complete -c deno -n &quot;__fish_use_subcommand&quot; -f -a &quot;help&quot; -d &#39;Prints this message or the help of the given subcommand(s)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from bundle&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from completions&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s T -l ts -d &#39;Treat eval input as TypeScript&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from eval&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l lock -d &#39;Check the specified lock file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l lock-write -d &#39;Write lock file. Use with --lock.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -l no-remote -d &#39;Do not resolve remote modules&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from cache&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -l check -d &#39;Check if the source files are formatted.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from fmt&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from info&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-read -d &#39;Allow file system read access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-write -d &#39;Allow file system write access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-net -d &#39;Allow network access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s n -l name -d &#39;Executable file name&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l root -d &#39;Installation root&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-env -d &#39;Allow environment access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-run -d &#39;Allow running subprocesses&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-plugin -d &#39;Allow loading plugins&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l allow-hrtime -d &#39;Allow high resolution time measurement&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s A -l allow-all -d &#39;Allow all permissions&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s f -l force -d &#39;Forcefully overwrite existing installation&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from install&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from repl&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-read -d &#39;Allow file system read access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-write -d &#39;Allow file system write access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-net -d &#39;Allow network access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l lock -d &#39;Check the specified lock file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l seed -d &#39;Seed Math.random()&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-env -d &#39;Allow environment access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-run -d &#39;Allow running subprocesses&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-plugin -d &#39;Allow loading plugins&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l allow-hrtime -d &#39;Allow high resolution time measurement&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s A -l allow-all -d &#39;Allow all permissions&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l lock-write -d &#39;Write lock file. Use with --lock.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l no-remote -d &#39;Do not resolve remote modules&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -l cached-only -d &#39;Require that remote dependencies are already cached&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from run&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l inspect -d &#39;activate inspector on host:port (default: 127.0.0.1:9229)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l inspect-brk -d &#39;activate inspector on host:port and break at start of user script&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-read -d &#39;Allow file system read access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-write -d &#39;Allow file system write access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-net -d &#39;Allow network access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l importmap -d &#39;UNSTABLE: Load import map file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s c -l config -d &#39;Load tsconfig.json configuration file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l lock -d &#39;Check the specified lock file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l v8-flags -d &#39;Set V8 command line options. For help: --v8-flags=--help&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l cert -d &#39;Load certificate authority from PEM encoded file&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l seed -d &#39;Seed Math.random()&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l filter -d &#39;A pattern to filter the tests to run by&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-env -d &#39;Allow environment access&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-run -d &#39;Allow running subprocesses&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-plugin -d &#39;Allow loading plugins&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-hrtime -d &#39;Allow high resolution time measurement&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s A -l allow-all -d &#39;Allow all permissions&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l lock-write -d &#39;Write lock file. Use with --lock.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l no-remote -d &#39;Do not resolve remote modules&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l cached-only -d &#39;Require that remote dependencies are already cached&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l failfast -d &#39;Stop on first error&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -l allow-none -d &#39;Don\\&#39;t return error code if no test files are found&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from test&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from types&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -l version -d &#39;The version to upgrade to&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -l dry-run -d &#39;Perform all checks without replacing old exe&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s f -l force -d &#39;Replace current exe even if not out-of-date&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from upgrade&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s r -l reload -d &#39;Reload source code cache (recompile TypeScript)&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -l unstable -d &#39;Enable unstable APIs&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -l json -d &#39;Output documentation in JSON format.&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from doc&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s L -l log-level -d &#39;Set log level&#39; -r -f -a &quot;debug info&quot; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s h -l help -d &#39;Prints help information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s V -l version -d &#39;Prints version information&#39; complete -c deno -n &quot;__fish_seen_subcommand_from help&quot; -s q -l quiet -d &#39;Suppress diagnostic output&#39; ``` 可以将其输出到文件并保存在 ~/.config/fish/completions 目录下，fish 里就可以生效使用了。 $ deno completions fish &gt; ~/.config/fish/completions/deno.fish 但是这样只能自己本地使用，如果换台机器需要重新进行上面的步骤，别人也没法共享。通过编写成 omf 插件发布后，就可通过 omf 进行安装使用了。 编写 omf 插件 根据 omf 的文档进行插件的编写。 通过 omf new plugin &lt;plugin-name&gt; 可快速初始化一个插件： $ omf new plugin plugin-deno 命令执行后生成了如下文件： . ├── LICENSE ├── README.md ├── completions │   └── plugin-deno.fish ├── functions │   └── plugin-deno.fish ├── init.fish └── uninstall.fish 其中，functions，init.fish 和 uninstall.fish 用不到，直接删除。 然后将 completions/plugin-deno.fish重命名成 completions/deno.fish，将 deno completions fish 的输出写入。 $ deno completions fish &gt; completions/deno.fish 完善 README.md 后就可以 push 到 GitHub 了。 测试安装 代码推送到远端后，可通过如下命令进行安装： $ omf install https://github.com/wayou/plugin-deno 添加到 omf 插件仓库 完成测试没问题后，最后一步，clone oh-my-fish/packages-main 添加名为 deno 的文件到 packages 目录下，完善其内容： type = plugin repository = YOUR-PACKAGE-URL maintainer = YOUR-NAME &lt;YOUR-EMAIL&gt; description = YOUR-PACKAGE-DESCRIPTION 便可以提 PR 到该仓库了。合并后即可通过 omf install deno 进行安装使用了。 相关资源 Writing your own completions¶","@type":"BlogPosting","headline":"创建 fish shell 自动补全文件","dateModified":"2020-05-17T23:05:00+08:00","datePublished":"2020-05-17T23:05:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="牛さんの部落格" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">牛さんの部落格</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">创建 fish shell 自动补全文件</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-05-17T23:05:00+08:00" itemprop="datePublished">May 17, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="创建-fish-shell-自动补全文件">创建 fish shell 自动补全文件</h1>

<p>关于自动补全的文档参见 <a href="http://fishshell.com/docs/current/index.html#tab-completion">Tab Completion</a>。</p>

<h2 id="completions-文件的位置">completions 文件的位置</h2>

<p>根据<a href="http://fishshell.com/docs/current/index.html#writing-your-own-completions">文档</a>，fish 自带的 completions 文件在 <code class="language-plaintext highlighter-rouge">/usr/share/fish/completions</code>。当然，根据安装来源及本机实际安装的插件，和其他环境的不同，fish 的默认 completions 文件和实际加载的来源会有差异，可以通过如下命令查看：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$fish_complete_path</span>
/Users/wayou/.config/fish/completions /Users/wayou/.local/share/omf/pkg/notify/completions /Users/wayou/.local/share/omf/pkg/notify/completions /Users/wayou/.local/share/omf/pkg/nvm/completions /Users/wayou/.local/share/omf/pkg/omf/completions /usr/local/Cellar/fish/3.1.0/etc/fish/completions /usr/local/Cellar/fish/3.1.0/share/fish/vendor_completions.d /usr/local/share/fish/vendor_completions.d /usr/local/Cellar/fish/3.1.0/share/fish/completions /Users/wayou/.local/share/fish/generated_completions
</code></pre></div></div>

<p>可以看出，本机因为安装的 omf，所以路径中包含了 omf 相关的路径。其中，因为 fish 是通过 brew 进行安装，其默认的 completions 文件在 <code class="language-plaintext highlighter-rouge">/usr/local/Cellar/fish/3.1.0/share/fish/completions</code>，可以查看该目录的文件进行学习，和自己编写 completion 文件的参数。</p>

<p>自己写的补全文件放置到 <code class="language-plaintext highlighter-rouge">~/.config/fish/completions</code> 目录下即可。如果没有该目录，创建一个。</p>

<h2 id="语法">语法</h2>

<p>自动实例是通过 <code class="language-plaintext highlighter-rouge">complete</code> 命令完成的，一般后面紧跟需要补全的命令名，比如 <code class="language-plaintext highlighter-rouge">myprog</code>，它可以跟一个 <code class="language-plaintext highlighter-rouge">yes</code> 或 <code class="language-plaintext highlighter-rouge">no</code> 作为其参数，补全脚本可以这样来写：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">complete</span> <span class="nt">-c</span> myprog <span class="nt">-a</span> <span class="s2">"yes no"</span>
</code></pre></div></div>

<p>其中，</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">-c</code> 即 <code class="language-plaintext highlighter-rouge">--command</code> 指定需要补全的命令名</li>
  <li><code class="language-plaintext highlighter-rouge">-a</code> 即 <code class="language-plaintext highlighter-rouge">--arguments</code> 指定命令后面自动列表出补全列表，形式为一个字符串，里面可通过空格，tab，<a href="https://fishshell.com/docs/2.3/index.html">variable expansion</a>，<a href="https://fishshell.com/docs/2.3/tutorial.html#tut_command_substitutions">Command Substitutions</a> 或其他形式的变量展开符进行分隔，这里简单知道可以用空格分隔补全列表即可。</li>
</ul>

<p>更加详尽的参数参见：<a href="http://fishshell.com/docs/current/cmds/complete.html#cmd-complete">complete - edit command specific tab-completions</a>。</p>

<h2 id="编写补全脚本">编写补全脚本</h2>

<p>因为测试需要实际有相应可执行程序才行，下面以 node 为例，为其添加自动补全。</p>

<p>创建补全文件到 <code class="language-plaintext highlighter-rouge">~/.config/fish/completions</code> 目录下：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">touch</span> ~/.config/fish/completions/test.fish
</code></pre></div></div>

<p>输入以下内容：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">complete</span> <span class="nt">-c</span> node <span class="nt">-a</span> <span class="s2">"yes no"</span>
</code></pre></div></div>

<h2 id="加载补全脚本">加载补全脚本</h2>

<p>讲道理，放到对应目录后，fish 会自动加载，但是在下次打开命令行的时候。如果要立即生效，需要重新 source 一下该文件：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">source</span> ~/.config/fish/completions/test.fish 
</code></pre></div></div>

<p>测试自动补全：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>node 
no <span class="nb">yes</span>
</code></pre></div></div>

<h3 id="关闭文件提示">关闭文件提示</h3>

<p>fish 默认会把当前目录下的文件作为补全候选对象，如果命令后不需要跟文件，可关通过 <code class="language-plaintext highlighter-rouge">-f</code> 即 <code class="language-plaintext highlighter-rouge">--no-files</code> 关闭文件的提示：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">complete</span> <span class="nt">-f</span> <span class="nt">-c</span> node <span class="nt">-a</span> <span class="s2">"yes no"</span>
</code></pre></div></div>

<h2 id="发布到-omf-插件">发布到 omf 插件</h2>

<p>发布到 omf 插件，这样别人可以通过 <code class="language-plaintext highlighter-rouge">omf install</code> 方便地安装。</p>

<h3 id="deno-的自动补全文件">deno 的自动补全文件</h3>

<p>以 deno 的自动补全为例。本周 <a href="https://twitter.com/deno_land/status/1260701643311583234?s=20">Deno 1.0 正式版释出</a>，伴随着自带了一个命令可输出对应 shell 下的自动补全脚本，比如 fish 的可通过如下命令获取到：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>deno completions fish
</code></pre></div></div>

<details>
<summary>
`deno completions fish` 的输出
</summary>


```sh
$ deno completions fish
complete -c deno -n "__fish_use_subcommand" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_use_subcommand" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_use_subcommand" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_use_subcommand" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_use_subcommand" -f -a "bundle" -d 'Bundle module and dependencies into single file'
complete -c deno -n "__fish_use_subcommand" -f -a "completions" -d 'Generate shell completions'
complete -c deno -n "__fish_use_subcommand" -f -a "eval" -d 'Eval script'
complete -c deno -n "__fish_use_subcommand" -f -a "cache" -d 'Cache the dependencies'
complete -c deno -n "__fish_use_subcommand" -f -a "fmt" -d 'Format source files'
complete -c deno -n "__fish_use_subcommand" -f -a "info" -d 'Show info about cache or info related to source file'
complete -c deno -n "__fish_use_subcommand" -f -a "install" -d 'Install script as an executable'
complete -c deno -n "__fish_use_subcommand" -f -a "repl" -d 'Read Eval Print Loop'
complete -c deno -n "__fish_use_subcommand" -f -a "run" -d 'Run a program given a filename or url to the module'
complete -c deno -n "__fish_use_subcommand" -f -a "test" -d 'Run tests'
complete -c deno -n "__fish_use_subcommand" -f -a "types" -d 'Print runtime TypeScript declarations'
complete -c deno -n "__fish_use_subcommand" -f -a "upgrade" -d 'Upgrade deno executable to given version'
complete -c deno -n "__fish_use_subcommand" -f -a "doc" -d 'Show documentation for a module'
complete -c deno -n "__fish_use_subcommand" -f -a "help" -d 'Prints this message or the help of the given subcommand(s)'
complete -c deno -n "__fish_seen_subcommand_from bundle" -l cert -d 'Load certificate authority from PEM encoded file'
complete -c deno -n "__fish_seen_subcommand_from bundle" -l importmap -d 'UNSTABLE: Load import map file'
complete -c deno -n "__fish_seen_subcommand_from bundle" -s c -l config -d 'Load tsconfig.json configuration file'
complete -c deno -n "__fish_seen_subcommand_from bundle" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from bundle" -l unstable -d 'Enable unstable APIs'
complete -c deno -n "__fish_seen_subcommand_from bundle" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from bundle" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from bundle" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from completions" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from completions" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from completions" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from completions" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from eval" -l inspect -d 'activate inspector on host:port (default: 127.0.0.1:9229)'
complete -c deno -n "__fish_seen_subcommand_from eval" -l inspect-brk -d 'activate inspector on host:port and break at start of user script'
complete -c deno -n "__fish_seen_subcommand_from eval" -l cert -d 'Load certificate authority from PEM encoded file'
complete -c deno -n "__fish_seen_subcommand_from eval" -l v8-flags -d 'Set V8 command line options. For help: --v8-flags=--help'
complete -c deno -n "__fish_seen_subcommand_from eval" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from eval" -l unstable -d 'Enable unstable APIs'
complete -c deno -n "__fish_seen_subcommand_from eval" -s T -l ts -d 'Treat eval input as TypeScript'
complete -c deno -n "__fish_seen_subcommand_from eval" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from eval" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from eval" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from cache" -s r -l reload -d 'Reload source code cache (recompile TypeScript)'
complete -c deno -n "__fish_seen_subcommand_from cache" -l lock -d 'Check the specified lock file'
complete -c deno -n "__fish_seen_subcommand_from cache" -l importmap -d 'UNSTABLE: Load import map file'
complete -c deno -n "__fish_seen_subcommand_from cache" -s c -l config -d 'Load tsconfig.json configuration file'
complete -c deno -n "__fish_seen_subcommand_from cache" -l cert -d 'Load certificate authority from PEM encoded file'
complete -c deno -n "__fish_seen_subcommand_from cache" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from cache" -l lock-write -d 'Write lock file. Use with --lock.'
complete -c deno -n "__fish_seen_subcommand_from cache" -l unstable -d 'Enable unstable APIs'
complete -c deno -n "__fish_seen_subcommand_from cache" -l no-remote -d 'Do not resolve remote modules'
complete -c deno -n "__fish_seen_subcommand_from cache" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from cache" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from cache" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from fmt" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from fmt" -l check -d 'Check if the source files are formatted.'
complete -c deno -n "__fish_seen_subcommand_from fmt" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from fmt" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from fmt" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from info" -l cert -d 'Load certificate authority from PEM encoded file'
complete -c deno -n "__fish_seen_subcommand_from info" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from info" -l unstable -d 'Enable unstable APIs'
complete -c deno -n "__fish_seen_subcommand_from info" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from info" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from info" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from install" -l allow-read -d 'Allow file system read access'
complete -c deno -n "__fish_seen_subcommand_from install" -l allow-write -d 'Allow file system write access'
complete -c deno -n "__fish_seen_subcommand_from install" -l allow-net -d 'Allow network access'
complete -c deno -n "__fish_seen_subcommand_from install" -s n -l name -d 'Executable file name'
complete -c deno -n "__fish_seen_subcommand_from install" -l root -d 'Installation root'
complete -c deno -n "__fish_seen_subcommand_from install" -l cert -d 'Load certificate authority from PEM encoded file'
complete -c deno -n "__fish_seen_subcommand_from install" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from install" -l allow-env -d 'Allow environment access'
complete -c deno -n "__fish_seen_subcommand_from install" -l allow-run -d 'Allow running subprocesses'
complete -c deno -n "__fish_seen_subcommand_from install" -l allow-plugin -d 'Allow loading plugins'
complete -c deno -n "__fish_seen_subcommand_from install" -l allow-hrtime -d 'Allow high resolution time measurement'
complete -c deno -n "__fish_seen_subcommand_from install" -s A -l allow-all -d 'Allow all permissions'
complete -c deno -n "__fish_seen_subcommand_from install" -s f -l force -d 'Forcefully overwrite existing installation'
complete -c deno -n "__fish_seen_subcommand_from install" -l unstable -d 'Enable unstable APIs'
complete -c deno -n "__fish_seen_subcommand_from install" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from install" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from install" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from repl" -l inspect -d 'activate inspector on host:port (default: 127.0.0.1:9229)'
complete -c deno -n "__fish_seen_subcommand_from repl" -l inspect-brk -d 'activate inspector on host:port and break at start of user script'
complete -c deno -n "__fish_seen_subcommand_from repl" -l v8-flags -d 'Set V8 command line options. For help: --v8-flags=--help'
complete -c deno -n "__fish_seen_subcommand_from repl" -l cert -d 'Load certificate authority from PEM encoded file'
complete -c deno -n "__fish_seen_subcommand_from repl" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from repl" -l unstable -d 'Enable unstable APIs'
complete -c deno -n "__fish_seen_subcommand_from repl" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from repl" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from repl" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from run" -l inspect -d 'activate inspector on host:port (default: 127.0.0.1:9229)'
complete -c deno -n "__fish_seen_subcommand_from run" -l inspect-brk -d 'activate inspector on host:port and break at start of user script'
complete -c deno -n "__fish_seen_subcommand_from run" -l allow-read -d 'Allow file system read access'
complete -c deno -n "__fish_seen_subcommand_from run" -l allow-write -d 'Allow file system write access'
complete -c deno -n "__fish_seen_subcommand_from run" -l allow-net -d 'Allow network access'
complete -c deno -n "__fish_seen_subcommand_from run" -l importmap -d 'UNSTABLE: Load import map file'
complete -c deno -n "__fish_seen_subcommand_from run" -s r -l reload -d 'Reload source code cache (recompile TypeScript)'
complete -c deno -n "__fish_seen_subcommand_from run" -s c -l config -d 'Load tsconfig.json configuration file'
complete -c deno -n "__fish_seen_subcommand_from run" -l lock -d 'Check the specified lock file'
complete -c deno -n "__fish_seen_subcommand_from run" -l v8-flags -d 'Set V8 command line options. For help: --v8-flags=--help'
complete -c deno -n "__fish_seen_subcommand_from run" -l cert -d 'Load certificate authority from PEM encoded file'
complete -c deno -n "__fish_seen_subcommand_from run" -l seed -d 'Seed Math.random()'
complete -c deno -n "__fish_seen_subcommand_from run" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from run" -l allow-env -d 'Allow environment access'
complete -c deno -n "__fish_seen_subcommand_from run" -l allow-run -d 'Allow running subprocesses'
complete -c deno -n "__fish_seen_subcommand_from run" -l allow-plugin -d 'Allow loading plugins'
complete -c deno -n "__fish_seen_subcommand_from run" -l allow-hrtime -d 'Allow high resolution time measurement'
complete -c deno -n "__fish_seen_subcommand_from run" -s A -l allow-all -d 'Allow all permissions'
complete -c deno -n "__fish_seen_subcommand_from run" -l unstable -d 'Enable unstable APIs'
complete -c deno -n "__fish_seen_subcommand_from run" -l lock-write -d 'Write lock file. Use with --lock.'
complete -c deno -n "__fish_seen_subcommand_from run" -l no-remote -d 'Do not resolve remote modules'
complete -c deno -n "__fish_seen_subcommand_from run" -l cached-only -d 'Require that remote dependencies are already cached'
complete -c deno -n "__fish_seen_subcommand_from run" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from run" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from run" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from test" -l inspect -d 'activate inspector on host:port (default: 127.0.0.1:9229)'
complete -c deno -n "__fish_seen_subcommand_from test" -l inspect-brk -d 'activate inspector on host:port and break at start of user script'
complete -c deno -n "__fish_seen_subcommand_from test" -l allow-read -d 'Allow file system read access'
complete -c deno -n "__fish_seen_subcommand_from test" -l allow-write -d 'Allow file system write access'
complete -c deno -n "__fish_seen_subcommand_from test" -l allow-net -d 'Allow network access'
complete -c deno -n "__fish_seen_subcommand_from test" -l importmap -d 'UNSTABLE: Load import map file'
complete -c deno -n "__fish_seen_subcommand_from test" -s r -l reload -d 'Reload source code cache (recompile TypeScript)'
complete -c deno -n "__fish_seen_subcommand_from test" -s c -l config -d 'Load tsconfig.json configuration file'
complete -c deno -n "__fish_seen_subcommand_from test" -l lock -d 'Check the specified lock file'
complete -c deno -n "__fish_seen_subcommand_from test" -l v8-flags -d 'Set V8 command line options. For help: --v8-flags=--help'
complete -c deno -n "__fish_seen_subcommand_from test" -l cert -d 'Load certificate authority from PEM encoded file'
complete -c deno -n "__fish_seen_subcommand_from test" -l seed -d 'Seed Math.random()'
complete -c deno -n "__fish_seen_subcommand_from test" -l filter -d 'A pattern to filter the tests to run by'
complete -c deno -n "__fish_seen_subcommand_from test" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from test" -l allow-env -d 'Allow environment access'
complete -c deno -n "__fish_seen_subcommand_from test" -l allow-run -d 'Allow running subprocesses'
complete -c deno -n "__fish_seen_subcommand_from test" -l allow-plugin -d 'Allow loading plugins'
complete -c deno -n "__fish_seen_subcommand_from test" -l allow-hrtime -d 'Allow high resolution time measurement'
complete -c deno -n "__fish_seen_subcommand_from test" -s A -l allow-all -d 'Allow all permissions'
complete -c deno -n "__fish_seen_subcommand_from test" -l unstable -d 'Enable unstable APIs'
complete -c deno -n "__fish_seen_subcommand_from test" -l lock-write -d 'Write lock file. Use with --lock.'
complete -c deno -n "__fish_seen_subcommand_from test" -l no-remote -d 'Do not resolve remote modules'
complete -c deno -n "__fish_seen_subcommand_from test" -l cached-only -d 'Require that remote dependencies are already cached'
complete -c deno -n "__fish_seen_subcommand_from test" -l failfast -d 'Stop on first error'
complete -c deno -n "__fish_seen_subcommand_from test" -l allow-none -d 'Don\'t return error code if no test files are found'
complete -c deno -n "__fish_seen_subcommand_from test" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from test" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from test" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from types" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from types" -l unstable -d 'Enable unstable APIs'
complete -c deno -n "__fish_seen_subcommand_from types" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from types" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from types" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from upgrade" -l version -d 'The version to upgrade to'
complete -c deno -n "__fish_seen_subcommand_from upgrade" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from upgrade" -l dry-run -d 'Perform all checks without replacing old exe'
complete -c deno -n "__fish_seen_subcommand_from upgrade" -s f -l force -d 'Replace current exe even if not out-of-date'
complete -c deno -n "__fish_seen_subcommand_from upgrade" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from upgrade" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from doc" -s r -l reload -d 'Reload source code cache (recompile TypeScript)'
complete -c deno -n "__fish_seen_subcommand_from doc" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from doc" -l unstable -d 'Enable unstable APIs'
complete -c deno -n "__fish_seen_subcommand_from doc" -l json -d 'Output documentation in JSON format.'
complete -c deno -n "__fish_seen_subcommand_from doc" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from doc" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from doc" -s q -l quiet -d 'Suppress diagnostic output'
complete -c deno -n "__fish_seen_subcommand_from help" -s L -l log-level -d 'Set log level' -r -f -a "debug info"
complete -c deno -n "__fish_seen_subcommand_from help" -s h -l help -d 'Prints help information'
complete -c deno -n "__fish_seen_subcommand_from help" -s V -l version -d 'Prints version information'
complete -c deno -n "__fish_seen_subcommand_from help" -s q -l quiet -d 'Suppress diagnostic output'
```

</details>

<p>可以将其输出到文件并保存在 <code class="language-plaintext highlighter-rouge">~/.config/fish/completions</code> 目录下，fish 里就可以生效使用了。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>deno completions fish <span class="o">&gt;</span>  ~/.config/fish/completions/deno.fish
</code></pre></div></div>

<p>但是这样只能自己本地使用，如果换台机器需要重新进行上面的步骤，别人也没法共享。通过编写成 omf 插件发布后，就可通过 omf 进行安装使用了。</p>

<h3 id="编写-omf-插件">编写 omf 插件</h3>

<p>根据 <a href="https://github.com/oh-my-fish/oh-my-fish/blob/master/docs/en-US/Packages.md">omf</a> 的文档进行插件的编写。</p>

<p>通过 <code class="language-plaintext highlighter-rouge">omf new plugin &lt;plugin-name&gt;</code> 可快速初始化一个插件：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>omf new plugin plugin-deno
</code></pre></div></div>

<p>命令执行后生成了如下文件：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── LICENSE
├── README.md
├── completions
│   └── plugin-deno.fish
├── functions
│   └── plugin-deno.fish
├── init.fish
└── uninstall.fish
</code></pre></div></div>

<p>其中，<code class="language-plaintext highlighter-rouge">functions</code>，<code class="language-plaintext highlighter-rouge">init.fish</code> 和 <code class="language-plaintext highlighter-rouge">uninstall.fish</code> 用不到，直接删除。</p>

<p>然后将 <code class="language-plaintext highlighter-rouge">completions/plugin-deno.fish</code>重命名成 <code class="language-plaintext highlighter-rouge">completions/deno.fish</code>，将 <code class="language-plaintext highlighter-rouge">deno completions fish</code> 的输出写入。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>deno completions fish <span class="o">&gt;</span> completions/deno.fish
</code></pre></div></div>

<p>完善 README.md 后就可以 push 到 GitHub 了。</p>

<h3 id="测试安装">测试安装</h3>

<p>代码推送到远端后，可通过如下命令进行安装：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>omf <span class="nb">install </span>https://github.com/wayou/plugin-deno
</code></pre></div></div>

<h3 id="添加到-omf-插件仓库">添加到 omf 插件仓库</h3>

<p>完成测试没问题后，最后一步，clone <a href="https://github.com/oh-my-fish/packages-main">oh-my-fish/packages-main</a> 添加名为 <code class="language-plaintext highlighter-rouge">deno</code> 的文件到 <code class="language-plaintext highlighter-rouge">packages</code> 目录下，完善其内容：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type = plugin
repository = YOUR-PACKAGE-URL
maintainer = YOUR-NAME &lt;YOUR-EMAIL&gt;
description = YOUR-PACKAGE-DESCRIPTION
</code></pre></div></div>

<p>便可以提 PR 到该仓库了。合并后即可通过 <code class="language-plaintext highlighter-rouge">omf install deno</code> 进行安装使用了。</p>

<h2 id="相关资源">相关资源</h2>

<ul>
  <li><a href="http://fishshell.com/docs/current/index.html#writing-your-own-completions">Writing your own completions¶</a></li>
</ul>


  </div><a class="u-url" href="/2020/05/17/%E5%88%9B%E5%BB%BA-fish-shell-%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%E6%96%87%E4%BB%B6.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">牛さんの部落格</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">牛さんの部落格</li><li><a class="u-email" href="mailto:liuwayong@gmail.com">liuwayong@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>notes about the coding life</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
